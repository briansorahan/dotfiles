#!/bin/bash
#
# Emacs setup script.
# Brian Sorahan 2012
#
# Setup my emacs environment without me having to lift a finger!
#
PWD=`pwd`
TEMP=/tmp
#
# js2-mode repo
# This is a fork of mooz's repo with default indentation set to 2 spaces.
#
JS2_REPO="git://github.com/briansorahan/js2-mode.git"
#
# workgroups repo
#
WORKGROUPS_REPO="git://github.com/tlh/workgroups.el.git"
#
# Default workgroup is relative to the emacs-setup repo
#
DEFAULT_WORKGROUP="${PWD}/workgroups/default"
#
# Directory where we will put .el files.
# This can be overridden with the -d option, but *must* be on your
# emacs load-path. 
#
EMACS_LOAD_DIR="/usr/share/emacs/site-lisp"
#
################################################################################
#
# Get command-line options
#
################################################################################
#
while getopts "d:" option
do
    case $option in
        d ) EMACS_LOAD_DIR=$OPTARG
    esac
done
#
################################################################################
#
# Create the .emacs file
#
################################################################################
#
cat >~/.emacs <<DOT_EMACS
;;
;; This file was automatically generated by emacs-setup
;;
;; Key bindings
(global-set-key (kbd \"C-<SPC>\") 'forward-word)
(global-set-key (kbd \"C-o\") 'scroll-down)

;; js2-mode
(autoload 'js2-mode "js2-mode" nil t)
(add-to-list 'auto-mode-alist '("\\.js$" . js2-mode))

;; make pretty colors in the shell
(add-hook 'shell-mode-hook 'ansi-color-for-comint-mode-on)

;; Dired-details
(require 'dired-details)
(require 'dired-details+)

;; Workgroups
(require 'workgroups)
(workgroups-mode 1)
(wg-load "${DEFAULT_WORKGROUP}")

DOT_EMACS
#
################################################################################
#
# Setup js2-mode
#
################################################################################
#
cd ${TEMP}
git clone ${JS2_REPO}
cd js2-mode
emacs --batch --eval '(byte-compile-file "js2-mode.el")'
rm ${EMACS_LOAD_DIR}/js2-mode*
cp js2-mode.elc ${EMACS_LOAD_DIR}
cd .. && rm -rf js2-mode
#
################################################################################
#
# Setup workgroups
#
################################################################################
#
cd ${TEMP}
git clone ${WORKGROUPS_REPO}
cd workgroups.el
emacs --batch --eval '(byte-compile-file "workgroups.el")'
rm ${EMACS_LOAD_DIR}/workgroups*
cp workgroups.elc ${EMACS_LOAD_DIR}
cd .. && rm -rf workgroups.el
#
################################################################################
#
# Setup dired-details (and dired-details+)
#
################################################################################
#
cd ${EMACS_LOAD_DIR}
wget http://www.emacswiki.org/emacs/download/dired-details.el
wget http://www.emacswiki.org/emacs-en/download/dired-details%2b.el
emacs --batch --eval '(byte-compile-file "dired-details.el")'
emacs --batch --eval '(byte-compile-file "dired-details+.el")'
